/*! Arboreal.js - v0.0.1 - 2017-04-12
* https://github.com/vasiliyaltunin/arboreal.js
* Copyright (c) 2017 Vasiliy Altunin (skyr@altunin.online); Licensed MIT; See MIT-LICENSE.txt for more info*/

!function(){function a(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1}function b(b,c){return a(b,c)>-1}function c(a,b,c){var d=!0;!function a(e){var f,g;if(d)if(!1===b(e))d=!1;else for(f=0;f<e.children.length;f++)g=e.children[f],a(g),void 0!==c&&c.call(g,g)}(a)}function d(a,b){for(var c,d;a;){if(!1===b(a))return;for(c=0;c<a.children.length;c++)if(d=a.children[c],!1===b(d))return;a=a.parent}}function e(a,b){for(;a;){if(!1===b(a))return;a=a.parent}}function f(a,c,d,e){var f=[];d(a,function(a){var d,e=a.id;if(!b(f,e)&&(d=c.call(a,a),f.push(e),!1===d))return d},e)}function g(a){var b,c=a.parent;for(b=0;b<c.children.length;b++)if(c.children[b]===a)return c.children.splice(b,1).shift()}function h(a,b){return b=b||"/",a?[a.id,a.children.length].join(b):"0"}function i(a,b,c,d){this.depth=a?a.depth+1:0,this.data=b||{},this.parent=a||null,this.separator=void 0===d?void 0!==a&&null!==a?this.parent.separator:"/":d,this.id=c||h(a,this.separator),this.children=[]}i.parse=function(a,b,c){var d,e=function(a){var c,d={};for(c in a)c!==b&&(d[c]=a[c]);return d};return function a(c,f){var g,h;if(f?(g=new i(f,e(c)),f.children.push(g)):g=d=new i(null,e(c)),b in c)for(h=0;h<c[b].length;h++)a(c[b][h],g)}(a,c),d||c},i.prototype.appendChild=function(a,b){var c=new i(this,a,b);return this.children.push(c),this},i.prototype.appendChildren=function(a,b){return i.parse(a,b,this)},i.prototype.removeChild=function(a){if("number"==typeof a&&this.children[a])return this.children.splice(a,1).shift();if(a instanceof i)return g(a);throw new Error("Invalid argument "+a)},i.prototype.remove=function(){return g(this)},i.prototype.traverseDown=function(a,b){f(this,a,c,b)},i.prototype.traverseUp=function(a){f(this,a,d)},i.prototype.bubbleUp=function(a){f(this,a,e)},i.prototype.toString=function(a){var b=[];return a=a||!1,this.traverseDown(function(c){var d,e="",f="";if(a&&(f=JSON.stringify(c.data)),0===c.depth)return void b.push(c.id+" "+f);for(d=0;d<c.depth;d++)e+=" ";b.push(e+"|- "+c.id+e+f)}),b.join("\n")},i.prototype.find=function(a){var b=null,c="function"==typeof a?a:function(c){if(c.id===a)return b=c,!1};return this.traverseDown(function(a){if(c.call(this,a))return b=a,!1}),b},i.prototype.path=function(a,b){b=b||"/",a[0]===b&&(a=a.substring(1));var c,d=a.split(b),e=null,f=this;for(c=0;c<d.length;c++)e=parseInt(d[c],10),f=f.children.length&&f.children.length>e?f.children[e]:null;return f},i.prototype.toArray=function(){var a=[];return this.traverseDown(function(b){a.push(b)}),a},i.prototype.root=function(){var a=this;if(!a.parent)return this;for(;a.parent;)a=a.parent;return a},i.prototype.isRoot=function(){return!this.parent},Object.defineProperty(i.prototype,"length",{get:function(){return this.toArray().length}}),"undefined"!=typeof module&&module.exports?module.exports=i:this.Arboreal=i}();